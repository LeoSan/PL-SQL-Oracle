

create  table pendupm.iaal_2  as (

select 
  DISTINCT gas.IDGASTO
, MT.NMMOTIVOGASTO
, gas.FDFECINI,gas.FDFECFIN
, gas.FDFECREGISTRO
, gas.IDSOLICITANTE
, gas.FCSTATUS,gas.FNEMPNOMINA
, gas.FCURGENTE,gas.FCVIATICO0
, sum(com.FNIMPORTE) FV_FNIMPORTE,sum(com.FNTOTAL) FV_FNTOTAL
, con.NMCONCEPTO ,con.IDTPOGASTO
, com.IDCOMPROBACION
, Gas.FDDYNAMICSCOMP
, PRO.NO_LOTE 
, CASE Gas.FCSTATUS WHEN 'R' THEN 'Registrado'
   WHEN 'P' THEN 'Pendiente de Autorización'
   WHEN 'A' THEN 'Autorizado'
   WHEN 'G' THEN 'En comprobación'
   WHEN 'C' THEN 'Comprobada'
   WHEN 'V' THEN 'Comprobacion Validada' 
   WHEN 'D' THEN 'Deposito de viaticos'
   WHEN 'F' THEN 'Finalizado'
   WHEN 'Z' THEN 'Cancelado'
   ELSE 'NO TIENE' END AS NOM_ESTATUS

FROM
   PENDUPM.GASTOMAIN Gas                           
   left join PENDUPM.comprobaciongasto com on gas.idgasto = com.idgasto
   left join PENDUPM.conceptogasto con on com.IDTPOGASTO = con.IDTPOGASTO and com.IDCONCEPTO = con.IDCONCEPTO
   INNER JOIN PENDUPM.CTMOTIVOGASTO MT ON MT.IDMOTIVOGASTO = Gas.IDMOTIVOGASTO
   LEFT JOIN PENDUPM.NUM_PRORRATEO PRO ON PRO.ID_GASTO = gas.idgasto 
WHERE 
gas.FDFECREGISTRO >= to_Date ( '2016/01/01' ,'yyyy/MM/dd') 
group by
  gas.IDGASTO
, MT.NMMOTIVOGASTO
, gas.FDFECINI
, gas.FDFECFIN
, gas.FDFECREGISTRO
, gas.IDSOLICITANTE
, gas.FCSTATUS
, gas.FNEMPNOMINA
, gas.FCURGENTE
, gas.FCVIATICO0
, con.NMCONCEPTO 
, con.IDTPOGASTO
, com.IDCOMPROBACION
, Gas.FDDYNAMICSCOMP
, PRO.NO_LOTE 

); 

GRANT DELETE, INSERT, SELECT, UPDATE ON PENDUPM.iaal TO PM_OPER;

GRANT DELETE, INSERT, SELECT, UPDATE ON PENDUPM.iaal TO TL_PM;


select IDGASTO, NMCONCEPTO, NMMOTIVOGASTO, NOM_ESTATUS, NO_LOTE, NMCONCEPTO, FDDYNAMICSCOMP, FDFECREGISTRO, IDSOLICITANTE, FCVIATICO0, FCURGENTE from pendupm.iaal_3  GROUP BY IDGASTO, NMCONCEPTO, NMMOTIVOGASTO, NOM_ESTATUS, NO_LOTE, NMCONCEPTO, FDDYNAMICSCOMP, FDFECREGISTRO, IDSOLICITANTE, FCVIATICO0, FCURGENTE 
