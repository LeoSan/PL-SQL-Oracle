 SELECT FNEMPNOMINA ID_EMPLEADO, A.IDGASTO PLAN_DE_VIAJE, NVL(FNMONTOGASTO,0) IMPORTE_SOLICITADO,
                   PENDUPM.PCKCTRLDOCUMENTAL01.aplFecha (FDFECINI,'2') FECHA_INICIO, PENDUPM.PCKCTRLDOCUMENTAL01.aplFecha (FDFECfin,'2') FECHA_FIN,
                   PENDUPM.PCKCTRLDOCUMENTAL01.aplFecha (FDCOMPROBACION,'2')  FECHA_COMPROBACION ,
                   (SELECT FCREFDYN  FROM PENDUPM.PLANVIAJEANTICIPO X WHERE X.IDGASTO = A.IDGASTO  AND FCTPOMOVTO = 'AN') REFERENCIA,
                   PENDUPM.PCKCONVENIOS.formatComas(NVL((SELECT SUM(FNTOTAL) FROM PENDUPM.COMPROBACIONGASTO X WHERE A.IDGASTO =X.IDGASTO AND IDTPOGASTO = 7 AND IDCONCEPTO = 1 ),0))  TOTAVION,
                   PENDUPM.PCKCONVENIOS.formatComas(NVL((SELECT SUM(FNTOTAL) FROM PENDUPM.COMPROBACIONGASTO X WHERE A.IDGASTO =X.IDGASTO AND IDTPOGASTO = 8 AND IDCONCEPTO = 1 ),0))  TOTRENTAAUT,
                   PENDUPM.PCKCONVENIOS.formatComas(NVL((SELECT SUM(FNTOTAL) FROM PENDUPM.COMPROBACIONGASTO X WHERE A.IDGASTO =X.IDGASTO AND IDTPOGASTO NOT IN (7,8) AND IDCONCEPTO = 1 ),0))  TOTVIATICOS
              FROM PENDUPM.GASTOMAIN A
            WHERE FCSTATUS IN ('F', 'T', 'H', 'I')
                AND (( FNMONTOGASTO > 0 AND FCVIATICO0 = 'N') OR ( FNMONTOGASTO = 0 AND FCVIATICO0 IN  'S'))
                AND (FCDYNAMICS IS NULL OR FCDYNAMICS != 'C')
                AND FDCOMPROBACION IS NOT NULL
                AND IDGASTO NOT IN (SELECT ID_GASTO FROM PENDUPM.PRORRATEOGASTO)
            ORDER BY A.IDGASTO;
